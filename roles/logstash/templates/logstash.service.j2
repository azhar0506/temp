[Unit]
Description=GCP-facing Logstash service
Documentation=https://www.elastic.co/guide/en/logstash/current/index.html

[Service]
Type=simple
User={{ logstash_user }}
Group={{ logstash_user }}
# Load env vars from /etc/default/ and /etc/sysconfig/ if they exist.
# Prefixing the path with '-' makes it try to load, but if the file doesn't
# exist, it continues onward.
EnvironmentFile=-/etc/default/logstash
EnvironmentFile=-/etc/sysconfig/logstash
Environment=LS_JAVA_OPTS="-Dhttp.proxyHost={{ logstash_proxy_host }} -Dhttp.proxyPort={{ logstash_proxy_port }} -Dhttps.proxyHost={{ logstash_proxy_host }} -Dhttps.proxyPort={{ logstash_proxy_port }} -Djava.io.tmpdir={{ logstash_dir }}/config"
Environment=GRPC_PROXY_EXP={{ logstash_proxy_host }}:{{ logstash_proxy_port }}
ExecStart={{ logstash_dir }}/bin/logstash --path.settings {{ logstash_dir }}/config

StandardOutput=file:{{ logstash_logs_dir }}/logstash.log
StandardError=file:{{ logstash_logs_dir }}/logstash-error.log

Restart=always
WorkingDirectory=/
Nice=19
LimitNOFILE=16384

# When stopping, how long to wait before giving up and sending SIGKILL?
# Keep in mind that SIGKILL on a process can cause data loss.
TimeoutStopSec=600

# Stop service from exiting with failed status.
# JVM does a clean shutdown but returns an exit code of 143.
SuccessExitStatus=143

[Install]
WantedBy=multi-user.target

